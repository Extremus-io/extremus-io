<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<script src="../../bower_components/page/page.js"></script>
<script>
    window.addEventListener('WebComponentsReady', function () {
        //jshint ignore:start
        var ws = new WebSocket("ws://localhost/ws/user/");
        ws.onmessage = function (evt) {
            data = JSON.parse(evt.data);
            if (!data.auth && typeof(data.auth)!=="undefined") {
                app.$.login_dialog.Error = true;
                app.$.login_dialog.LoginError = 'Please login to continue';
                app.$.login_dialog.noCancel = true;
                app.$.login_dialog.open();
            }
            app.$.controller.msgHandler(evt.data);
        };
        ws.onopen = function () {
            var toast = document.getElementById('online-toast');
            toast.text = 'Connected!';
            toast.show();
        };
        ws.onerror = function () {
            var toast = document.getElementById('offline-toast');
            toast.text = 'App is offline!';
            toast.show();
        };
        ws.onclose = function () {
            var toast = document.getElementById('offline-toast');
            toast.text = 'App is offline!';
            toast.show();
        };
        //jshint ignore:end
        // We use Page.js for routing. This is a Micro
        // client-side router inspired by the Express router
        // More info: https://visionmedia.github.io/page.js/
        //jshint ignore:start
        page('/', function () {
            app.route = 'dashboard';
        });

        page('/:main/', function (data) {
            app.route = data.params.main;
            cont = app.$.controller;
            cont.showMenu(ws);
        });

        page('/controllers/:item/', function (data) {
            app.route = 'controllers';
            cont = app.$.controller;
            cont.showDetail(ws, data.params.item)
        });
        //jshint ignore:end
        page();
    });
</script>
